name: Teste Seguro de Secrets (mascarado)

on:
  push:
    branches: [ main ]

permissions:
  contents: read     # reduza permissões do GITHUB_TOKEN

jobs:
  safe-demo:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout sem credenciais persistentes
        uses: actions/checkout@v4
        with:
          persist-credentials: false  # evita que GITHUB_TOKEN seja colocado no workspace

      - name: Definir variáveis de ambiente a partir de secrets (somente para teste)
        env:
          AWS_KEY: ${{ secrets.TEST_AWS_KEY }}
          NPM_TOKEN: ${{ secrets.TEST_NPM_TOKEN }}
          GH_TOKEN: ${{ secrets.TEST_GH_TOKEN }}
        run: |
          # Mostrar apenas os 4 primeiros caracteres e mascarar o resto
          echo "AWS_KEY: ${AWS_KEY:0:4}***"
          echo "NPM_TOKEN: ${NPM_TOKEN:0:4}***"
          echo "GH_TOKEN: ${GH_TOKEN:0:4}***"

      - name: Simular uso seguro (não printa secrets)
        run: |
          # simule uma chamada que usa o token sem expô-lo
          if [ -n "$AWS_KEY" ]; then
            echo "Simulação: AWS Key disponível e não exposta."
          fi
